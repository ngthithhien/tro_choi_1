<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
<title>Nghe vÃ  tÃ¬m chá»¯ â€” Mobile Ready</title>
<style>
  @font-face {
    font-family: "UTM Avo";
    src: url("fonts/UTMAvo.ttf") format("truetype");
    font-weight: normal;
    font-style: normal;
  }
  :root{
    --pink:#ff6bcb; --purple:#6c5ce7; --white:#fff;
  }
  html,body{
    height:100%;margin:0;padding:0;
    font-family:"UTM Avo", sans-serif;
    background:linear-gradient(135deg,#f6d365,#fda085);
    -webkit-tap-highlight-color:transparent;
  }
  body{display:flex;flex-direction:column;align-items:center;overflow:hidden;}
  #top-buttons{position:fixed;right:10px;top:10px;display:flex;flex-direction:column;gap:8px;z-index:400}
  .top-btn{padding:10px 14px;font-size:14px;border:0;border-radius:12px;background:var(--pink);color:var(--white);cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,.15)}
  .top-btn:active{transform:scale(.98)}

  /* ---- NÃšT FULLSCREEN ---- */
  #btnFull {
    padding:10px 14px;
    font-size:14px;
    border:0;
    border-radius:12px;
    background:#444;
    color:white;
    cursor:pointer;
    box-shadow:0 4px 10px rgba(0,0,0,.2);
  }
  #btnFull:active{transform:scale(.98)}

  #result-area{width:100%;display:flex;justify-content:center;gap:4vw;min-height:18vh;margin-top:6vh;pointer-events:none}
  .result-item{width:28vw;max-width:220px;height:28vw;max-height:220px;background:var(--white);border-radius:18px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,.18)}
  .result-item img{width:88%;height:88%;object-fit:contain}
  #letters{display:flex;gap:4vw;justify-content:center;margin-top:4vh;transform:translateY(-1vh);z-index:100}
  .letter-box{width:28vw;max-width:220px;height:28vw;max-height:220px;background:var(--white);border-radius:22px;display:flex;align-items:center;justify-content:center;font-size:clamp(64px,10vw,120px);box-shadow:0 6px 18px rgba(0,0,0,.18);touch-action:manipulation;user-select:none;cursor:pointer}
  .letter-box:active{transform:scale(.96)}
  .letter-box.shake{animation:shake .42s}
  @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-10px)}50%{transform:translateX(10px)}75%{transform:translateX(-10px)}}
  .big-btn{
    position:fixed;left:50%;transform:translateX(-50%);
    bottom:18px;z-index:300;
    border:0;border-radius:20px;background:var(--purple);color:white;
    font-size:clamp(18px,4.5vw,26px);padding:12px 28px;box-shadow:0 6px 18px rgba(0,0,0,.2);
    display:none;touch-action:manipulation;cursor:pointer;
  }
  .big-btn:active{transform:translateX(-50%) scale(.98)}
  @media (max-width:420px){
    .letter-box{width:30vw;height:30vw}
    .result-item{width:34vw;height:34vw}
  }
  .firework{position:fixed;width:10px;height:10px;border-radius:50%;background:yellow;pointer-events:none;animation:boom 1s forwards}
  @keyframes boom{0%{transform:scale(1);opacity:1}100%{transform:scale(18);opacity:0}}
  .snowflake{position:fixed;width:8px;height:8px;border-radius:50%;background:white;pointer-events:none;animation:snow linear infinite}
  @keyframes snow{0%{transform:translateY(-10px) rotate(0deg)}100%{transform:translateY(100vh) rotate(360deg)}}
</style>
</head>
<body>

<div id="top-buttons">
  <button id="btnStart" class="top-btn">Báº¯t Ä‘áº§u</button>
  <button id="btnRestart" class="top-btn">ChÆ¡i láº¡i</button>
  <button id="btnEnd" class="top-btn">Káº¿t thÃºc</button>
  <button id="btnFull">ðŸ”³ Full mÃ n hÃ¬nh</button>
</div>

<div id="result-area"></div>

<div id="letters">
  <div class="letter-box" data-letter="a">a</div>
  <div class="letter-box" data-letter="Äƒ">Äƒ</div>
  <div class="letter-box" data-letter="Ã¢">Ã¢</div>
</div>

<button id="btnListen" class="big-btn">Nghe</button>
<button id="btnNext" class="big-btn">Nghe tiáº¿p</button>

<script>
function makeAudio(src){
  const a = new Audio(src);
  a.preload = 'auto';
  a.load();
  return a;
}

const sounds = {
  "a": makeAudio("audio/a.mp3"),
  "Äƒ": makeAudio("audio/Äƒ.mp3"),
  "Ã¢": makeAudio("audio/Ã¢.mp3"),
  "correct": makeAudio("audio/correct.mp3"),
  "wrong": makeAudio("audio/wrong.mp3"),
  "complete": makeAudio("audio/complete.mp3")
};

let remaining = [];
let currentLetter = "";
let gameActive = false;

const btnStart = document.getElementById("btnStart");
const btnRestart = document.getElementById("btnRestart");
const btnEnd = document.getElementById("btnEnd");
const btnListen = document.getElementById("btnListen");
const btnNext = document.getElementById("btnNext");
const resultArea = document.getElementById("result-area");

/* ---------------- FULLSCREEN ---------------- */
const btnFull = document.getElementById("btnFull");

btnFull.addEventListener("click", () => {
  let elem = document.documentElement;

  if (!document.fullscreenElement &&
      !document.webkitFullscreenElement &&
      !document.msFullscreenElement) {

      if (elem.requestFullscreen) elem.requestFullscreen();
      else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
      else if (elem.msRequestFullscreen) elem.msRequestFullscreen();

      btnFull.textContent = "âŽ ThoÃ¡t full mÃ n hÃ¬nh";
  } else {
      if (document.exitFullscreen) document.exitFullscreen();
      else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
      else if (document.msExitFullscreen) document.msExitFullscreen();

      btnFull.textContent = "ðŸ”³ Full mÃ n hÃ¬nh";
  }
});
/* ------------------------------------------- */

async function unlockAudio(){
  try{
    for(const k in sounds){
      const s = sounds[k];
      s.muted = true;
      await s.play().catch(()=>{});
      s.pause();
      s.currentTime = 0;
      s.muted = false;
    }
  }catch(e){}
}

async function startGame(){
  await unlockAudio();
  remaining = ["a","Äƒ","Ã¢"];
  currentLetter = "";
  gameActive = true;
  resultArea.innerHTML = "";
  btnListen.style.display = "block";
  btnNext.style.display = "none";
}

async function restartGame(){ await startGame(); }

function endGame(){
  gameActive = false;
  currentLetter = "";
  btnListen.style.display = "none";
  btnNext.style.display = "none";
  for(const k in sounds){
    try{ sounds[k].pause(); sounds[k].currentTime = 0; }catch(e){}
  }
  document.querySelectorAll(".firework, .snowflake").forEach(n=>n.remove());
  resultArea.innerHTML = "";
}

function chooseNextLetter(){
  if(remaining.length === 0){ finishGame(); return; }
  currentLetter = remaining[Math.floor(Math.random()*remaining.length)];
  btnListen.style.display = "block";
  btnNext.style.display = "none";
}

function playSound(key){
  if(!sounds[key]) return;
  try{
    sounds[key].pause();
    sounds[key].currentTime = 0;
    const p = sounds[key].play();
    if(p && p.catch) p.catch(()=>{});
  }catch(e){}
}

btnListen.addEventListener("click", ()=>{
  if(!gameActive) return;
  if(currentLetter==="") chooseNextLetter();
  if(currentLetter) playSound(currentLetter);
});
btnNext.addEventListener("click", ()=>{
  if(!gameActive) return;
  chooseNextLetter();
  if(currentLetter) playSound(currentLetter);
});

[...document.querySelectorAll(".letter-box")].forEach(box=>{
  const handler = ()=> {
    if(!gameActive) return;
    if(currentLetter==="") return;
    const chosen = box.dataset.letter;
    if(chosen === currentLetter) correctAnswer(chosen);
    else wrongAnswer(box);
  };
  box.addEventListener("click", handler);
  box.addEventListener("touchstart", e=>{ e.preventDefault(); handler(); });
});

function wrongAnswer(box){
  playSound("wrong");
  box.classList.add("shake");
  setTimeout(()=>box.classList.remove("shake"),420);
}

function correctAnswer(letter){
  playSound("correct");
  const d = document.createElement("div");
  d.className = "result-item";
  d.innerHTML = `<img src="images/${letter}.png" alt="${letter}">`;
  resultArea.appendChild(d);
  remaining = remaining.filter(l=>l!==letter);
  currentLetter = "";
  fireworks();
  snowEffect();
  if(remaining.length>0){
    btnListen.style.display = "none";
    btnNext.style.display = "block";
  } else {
    finishGame();
  }
}

function finishGame(){
  gameActive = false;
  btnListen.style.display = "none";
  btnNext.style.display = "none";
  fireworks(); snowEffect();
  playSound("complete");
}

function fireworks(){
  for(let i=0;i<10;i++){
    const f = document.createElement("div");
    f.className = "firework";
    f.style.left = (Math.random()*100) + "vw";
    f.style.top = (10 + Math.random()*40) + "vh";
    document.body.appendChild(f);
    setTimeout(()=>f.remove(),1000);
  }
}

function snowEffect(){
  for(let i=0;i<14;i++){
    const s = document.createElement("div");
    s.className = "snowflake";
    s.style.left = (Math.random()*100)+"vw";
    s.style.top = (-10 - Math.random()*20)+"vh";
    s.style.animationDuration = (3 + Math.random()*3) + "s";
    document.body.appendChild(s);
    setTimeout(()=>s.remove(),5000);
  }
}

btnStart.addEventListener("click", startGame);
btnRestart.addEventListener("click", restartGame);
btnEnd.addEventListener("click", endGame);

btnStart.addEventListener("touchstart", e=>{ e.preventDefault(); startGame(); });
btnRestart.addEventListener("touchstart", e=>{ e.preventDefault(); restartGame(); });
btnEnd.addEventListener("touchstart", e=>{ e.preventDefault(); endGame(); });

(function init(){
  btnListen.style.display = "none";
  btnNext.style.display = "none";
  remaining = [];
  currentLetter = "";
  gameActive = false;
})();
</script>
</body>
</html>
